<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>N-body matrix elements · EnergyExpressions</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><script src="../assets/latex.js"></script></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.png" alt="EnergyExpressions logo"/></a><h1>EnergyExpressions</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><span class="toctext">Theory</span><ul><li><a class="toctext" href="../notation/">Notation</a></li><li><a class="toctext" href="../energy_expressions/">Energy Expressions</a></li><li><a class="toctext" href="../calculus_of_variations/">Calculus of Variations</a></li></ul></li><li><span class="toctext">Implementation</span><ul><li><a class="toctext" href="../conjugate_orbitals/">Conjugate orbitals</a></li><li><a class="toctext" href="../slater_determinants/">Slater determinants</a></li><li><a class="toctext" href="../nbody_operators/">N-body operators</a></li><li class="current"><a class="toctext" href>N-body matrix elements</a><ul class="internal"><li><a class="toctext" href="#Calculation-of-determinants-1">Calculation of determinants</a></li></ul></li><li><a class="toctext" href="../common_operators/">Common N-body operators</a></li><li><a class="toctext" href="../equations/">N-body equations</a></li><li><a class="toctext" href="../variations/">Variation</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Implementation</li><li><a href>N-body matrix elements</a></li></ul><a class="edit-page" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/master/docs/src/nbody_matrix_elements.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>N-body matrix elements</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="N-body-matrix-elements-1" href="#N-body-matrix-elements-1">N-body matrix elements</a></h1><p>The matrix element of an N-body operator between two Slater determinants may be expanded according to the Löwdin rules (which reduce to the Slater–Condon rules if all single-particle orbitals are orthogonal):</p><div>\[\begin{equation}
\label{eqn:matrix-element-expansion}
\matrixel{\Phi_A}{\Omega_n}{\Phi_B} =
\frac{1}{n!}\sum_p (-)^p
\matrixel{k_1k_2...k_n}{\Omega_n}{l_1l_2...l_n}
D^{AB}({k_1k_2...k_n}|{l_1l_2...l_n})
\end{equation}\]</div><p>where <span>$D^{AB}({k_1k_2...k_n}|{l_1l_2...l_n})$</span> is the determinant minor of the orbital overlap determinant <span>$D^{AB}$</span> with the rows <span>${k_1k_2...k_n}$</span> and columns <span>${l_1l_2...l_n}$</span> stricken out, and <span>$p$</span> runs over all permutations.</p><p>In general, a term in the expansion is thus of the form</p><div>\[\begin{equation}
\alpha\matrixel{k_1k_2...k_n}{\Omega_n}{l_1l_2...l_n}\braket{a}{b}\braket{c}{d}\dots\braket{y}{z},
\end{equation}\]</div><p>where <span>$\alpha$</span> is a scalar. This is represented by <a href="#EnergyExpressions.NBodyTerm"><code>NBodyTerm</code></a> type.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.NBodyTermFactor" href="#EnergyExpressions.NBodyTermFactor"><code>EnergyExpressions.NBodyTermFactor</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">NBodyTermFactor</code></pre><p>Abstract type for a factor in a term in a N-body matrix element expansion</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L3-L7">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.OrbitalOverlap" href="#EnergyExpressions.OrbitalOverlap"><code>EnergyExpressions.OrbitalOverlap</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">OrbitalOverlap(a,b)</code></pre><p>Represents the overlap between the orbitals <code>a</code> and <code>b</code> in a N-body matrix element expansion.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; EnergyExpressions.OrbitalOverlap(:a,:b)
⟨a|b⟩</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L10-L21">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.OrbitalMatrixElement" href="#EnergyExpressions.OrbitalMatrixElement"><code>EnergyExpressions.OrbitalMatrixElement</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">OrbitalMatrixElement(a,o,b)</code></pre><p>Represents the N-body matrix element between the sets of orbitals <code>a</code> and <code>b</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; struct MyTwoBodyOperator &lt;: TwoBodyOperator end

julia&gt; EnergyExpressions.OrbitalMatrixElement((:a,:b), MyTwoBodyOperator(), (:c,:d))
⟨a b|MyTwoBodyOperator()|c d⟩</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L35-L48">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.NBodyTerm" href="#EnergyExpressions.NBodyTerm"><code>EnergyExpressions.NBodyTerm</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">NBodyTerm(factors, coeff)</code></pre><p>Structure representing one term in the expansion of a N-body matrix element.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L84-L88">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.NBodyMatrixElement" href="#EnergyExpressions.NBodyMatrixElement"><code>EnergyExpressions.NBodyMatrixElement</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">NBodyMatrixElement(terms)</code></pre><p>Structure representing the expansion of a N-body matrix element.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L144-L148">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.overlap_matrix" href="#EnergyExpressions.overlap_matrix"><code>EnergyExpressions.overlap_matrix</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">overlap_matrix(a::SlaterDeterminant, b::SlaterDeterminant[, overlaps=[]])</code></pre><p>Generate the single-particle orbital overlap matrix, between the orbitals in the Slater determinants <code>a</code> and <code>b</code>. All orbitals are assumed to be orthogonal, except for those which are given in <code>overlaps</code>.</p><p><strong>Examples</strong></p><p>First we define two Slater determinants that have some orbitals in common:</p><pre><code class="language-julia-repl">julia&gt; sa = SlaterDeterminant([:i, :j, :l,:k̃])
i(1)j(2)l(3)k̃(4) - i(1)j(2)l(4)k̃(3) - i(1)j(3)l(2)k̃(4) + i(1)j(3)l(4)k̃(2) + …  + i(4)j(1)l(3)k̃(2) + i(4)j(2)l(1)k̃(3) - i(4)j(2)l(3)k̃(1) - i(4)j(3)l(1)k̃(2) + i(4)j(3)l(2)k̃(1)

julia&gt; sb = SlaterDeterminant([:i, :j, :k, :l̃])
i(1)j(2)k(3)l̃(4) - i(1)j(2)k(4)l̃(3) - i(1)j(3)k(2)l̃(4) + i(1)j(3)k(4)l̃(2) + …  + i(4)j(1)k(3)l̃(2) + i(4)j(2)k(1)l̃(3) - i(4)j(2)k(3)l̃(1) - i(4)j(3)k(1)l̃(2) + i(4)j(3)k(2)l̃(1)</code></pre><p>The orbital overlap matrix by default is</p><pre><code class="language-julia-repl">julia&gt; overlap_matrix(sa, sb)
4×4 SparseArrays.SparseMatrixCSC{EnergyExpressions.NBodyTerm,Int64} with 2 stored entries:
  [1, 1]  =  1
  [2, 2]  =  1</code></pre><p>which has only two non-zero entries, since only two of the orbitals are common between the Slater determinants <code>sa</code> and <code>sb</code>.</p><p>We can then define that the orbitals <code>k̃</code> and <code>l̃</code> are non-orthogonal:</p><pre><code class="language-julia-repl">julia&gt; overlap_matrix(sa, sb, [OrbitalOverlap(:k̃,:l̃)])
4×4 SparseArrays.SparseMatrixCSC{EnergyExpressions.NBodyTerm,Int64} with 3 stored entries:
  [1, 1]  =  1
  [2, 2]  =  1
  [4, 4]  =  ⟨k̃|l̃⟩</code></pre><p>We can even specify that the orbital <code>k̃</code> is non-orthogonal to <em>itself</em> (this can be useful when the <code>k̃</code> is a linear combination of orthogonal orbitals):</p><pre><code class="language-julia-repl">julia&gt; overlap_matrix(sa, sa, [OrbitalOverlap(:k̃,:k̃)])
4×4 SparseArrays.SparseMatrixCSC{EnergyExpressions.NBodyTerm,Int64} with 4 stored entries:
  [1, 1]  =  1
  [2, 2]  =  1
  [3, 3]  =  1
  [4, 4]  =  ⟨k̃|k̃⟩</code></pre><p>Notice that this overlap matrix was calculated between the Slater determinant <code>sa</code> and itself. </p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L359-L407">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.Matrix" href="#Base.Matrix"><code>Base.Matrix</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">Matrix(op::QuantumOperator, slater_determinants[, overlaps])</code></pre><p>Generate the matrix corresponding to the quantum operator <code>op</code>, between the different <code>slater_determinants</code>. It is possible to specify non-orthogonalities between single-particle orbitals in <code>overlaps</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L427-L433">source</a></section><h2><a class="nav-anchor" id="Calculation-of-determinants-1" href="#Calculation-of-determinants-1">Calculation of determinants</a></h2><p>Actually computing the matrix element expansion <span>$\eqref{eqn:matrix-element-expansion}$</span> is a combinatorial problem, that grows factorially with the amount of non-orthogonal orbital pairs. Furthermore, of the <span>$(n!)^2$</span> terms generated from the expansion, only <span>$n!$</span> are distinct, due to the integrals being symmetric with respect to interchange of the coordinates [hence the normalization factor <span>$(n!)^{-1}$</span>]. Thankfully, there are few symmetries that can be employed, to generate only the distinct permutations.</p><p>We use Julia&#39;s built in <code>CartesianIndex</code> iterators to span the space of all possible choices of orbitals for the overlap determinant. If two or more indices in the <code>CartesianIndex</code> are the same, the overlap is trivially zero (the “Fermi hole”). To avoid double-counting, we also only consider those indices that are above the hyper-diagonal.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.isabovediagonal" href="#EnergyExpressions.isabovediagonal"><code>EnergyExpressions.isabovediagonal</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">isabovediagonal(i::CartesianIndex{N})</code></pre><p>Returns <code>true</code> if the CartesianIndex <code>i</code> is above the hyper-diagonal.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L199-L203">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.isdiagonal" href="#EnergyExpressions.isdiagonal"><code>EnergyExpressions.isdiagonal</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">isdiagonal(i::CartesianIndex)</code></pre><p>Returns <code>true</code> if the CartesianIndex <code>i</code> is diagonal in any dimensions, i.e. if not all coordinates are unique. The density matrices vanish in this case, due to the Pauli principle; this is also known as the “Fermi hole”.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L211-L218">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.detaxis" href="#EnergyExpressions.detaxis"><code>EnergyExpressions.detaxis</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">detaxis(i::CartesianIndex{N})</code></pre><p>Generate the axis index vector for the determinant minor, whose rows or columns represented by the <code>CartesianIndex</code> <code>i</code> should be omitted. Implemented via <a href="../nbody_operators/#EnergyExpressions.complement"><code>complement</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L221-L227">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.detminor" href="#EnergyExpressions.detminor"><code>EnergyExpressions.detminor</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">detminor(k, l, A)</code></pre><p>Calculate the <a href="https://en.wikipedia.org/wiki/Minor_(linear_algebra)">determinant minor</a> of <code>A</code>, where the rows <code>k</code> and the columns <code>l</code> have been stricken out.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L231-L237">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.cofactor" href="#EnergyExpressions.cofactor"><code>EnergyExpressions.cofactor</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">cofactor(k, l, A)</code></pre><p>Calculate the <a href="https://en.wikipedia.org/wiki/Minor_(linear_algebra)">cofactor</a> of <code>A</code>, where the rows <code>k</code> and the columns <code>l</code> have been stricken out.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L246-L252">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LinearAlgebra.det" href="#LinearAlgebra.det"><code>LinearAlgebra.det</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">det(A)</code></pre><p>Calculate the determinant of the matrix <code>A</code> whose elements are of the <a href="#EnergyExpressions.NBodyTerm"><code>NBodyTerm</code></a> type, by expanding the determinant along the first column. This is an expensive operation, and should only be done with relatively sparse matrices.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L255-L262">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="EnergyExpressions.permutation_sign" href="#EnergyExpressions.permutation_sign"><code>EnergyExpressions.permutation_sign</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">permutation_sign(p)</code></pre><p>Calculate the sign of the permutation <code>p</code>, 1 if <code>iseven(p)</code>, -1 otherwise.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaAtoms/EnergyExpressions.jl/blob/0a34e684799d55ce79232e2f332177fb00cb0b4b/src/nbody_matrix_elements.jl#L279-L284">source</a></section><footer><hr/><a class="previous" href="../nbody_operators/"><span class="direction">Previous</span><span class="title">N-body operators</span></a><a class="next" href="../common_operators/"><span class="direction">Next</span><span class="title">Common N-body operators</span></a></footer></article></body></html>
